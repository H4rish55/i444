# edited annotated log

# usage
$ ./index.mjs

usage: index.mjs DB_URL (register|login|get|query|update|remove|clear) PARAMS_JSON

# register with JSON syntax error
$ ./index.mjs mongodb://localhost:27017/auth register \
    '{"email": "zdu@x.com", "firstName": "zerksis", "lastName": "umrigar", }'
bad data json {"email": "zdu@x.com", "firstName": "zerksis", "lastName": "umrigar", }; Expected double-quoted property name in JSON at position 70 (line 1 column 71)

# register missing password
$ ./index.mjs mongodb://localhost:27017/auth register \
    '{"email": "zdu@x.com", "firstName": "zerksis", "lastName": "umrigar" }'
E_MISSING: password is required
E_MISSING: confirmPassword is required

# register not sufficiently strong password
$ ./index.mjs mongodb://localhost:27017/auth register \
  '{"email": "zdu@x.com", "firstName": "zerksis", "lastName": "umrigar",
     "password": "abcd1234", "confirmPassword": "abcd1234" }'
E_BAD_VAL: password must contain at least one lowercase letter, 
           one uppercase letter, one digit and one punctuation character

# success!!
$ $ ./index.mjs mongodb://localhost:27017/auth register \
  '{"email": "zdu@x.com", "firstName": "zerksis", "lastName": "umrigar",
     "password": "Abcd1234!", "confirmPassword": "Abcd1234!" }'
{
  id: '1_07',
  email: 'zdu@x.com',
  firstName: 'zerksis',
  lastName: 'umrigar'
}

# login
$ ./index.mjs mongodb://localhost:27017/auth login \
     '{"email": "zdu@x.com", "password": "Abcd1234!" }'
{
  id: '1_07',
  email: 'zdu@x.com',
  firstName: 'zerksis',
  lastName: 'umrigar'
}

# access user
$ ./index.mjs mongodb://localhost:27017/auth get '{"id": "1_07" }'
{
  id: '1_07',
  email: 'zdu@x.com',
  firstName: 'zerksis',
  lastName: 'umrigar'
}

# upcase firstName
./index.mjs mongodb://localhost:27017/auth update \
              '{"id": "1_07", "firstName": "Zerksis" }'
> {
  id: '1_07',
  email: 'zdu@x.com',
  firstName: 'Zerksis',
  lastName: 'umrigar'
}

# remove user
./index.mjs mongodb://localhost:27017/auth remove '{"id": "1_07" }'
undefined

# no longer able to login
$ ./index.mjs mongodb://localhost:27017/auth login \
              '{"email": "zdu@x.com", "password": "Abcd1234!" }'
BAD_LOGIN: invalid login
$ 